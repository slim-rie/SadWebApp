{% extends "auth_base.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
{% block head %}
<link rel="stylesheet" href="{{url_for('static', filename='profile.css')}}" />
{% endblock %}

<div class="profile-page">
  <header class="profile-header">
    <div class="profile-image-container">
      <img 
        src="{{ url_for('static', filename='profile_images/' + current_user.profile_image) if current_user.profile_image else url_for('static', filename='pictures/default_profile.jpg') }}"
        alt="Profile Picture"
        class="profile-image"
        id="preview-image"
      />
      <div class="image-upload">
        <label for="profile-upload" class="upload-label">Change Picture</label>
        <input type="file" id="profile-upload" name="profile_image" accept="image/*" style="display: none;" />
      </div>
    </div>
  </header>

  <main class="profile-content">
    <h1>My Profile</h1>
    <p>Manage and protect your account</p>
    <hr>

    <form method="POST" action="{{ url_for('auth.update_profile') }}" class="profile-form" enctype="multipart/form-data">
      <div class="form-group">
        <label for="username">Username*</label>
        <input type="text" id="username" name="username" value="{{ current_user.username }}" required>
      </div>

      <div class="form-group">
        <label for="email">Email*</label>
        <input type="email" id="email" name="email" value="{{ current_user.email }}" required readonly>
      </div>

      <div class="form-group">
        <label for="address">Address*</label>
        <textarea id="address" name="address" required>{{ current_user.address }}</textarea>
      </div>

      <div class="form-group">
        <label for="first_name">First Name*</label>
        <input type="text" id="first_name" name="first_name" value="{{ current_user.first_name }}" required>
      </div>

      <div class="form-group">
        <label for="middle_name">Middle Name</label>
        <input type="text" id="middle_name" name="middle_name" value="{{ current_user.middle_name }}">
      </div>

      <div class="form-group">
        <label for="last_name">Last Name*</label>
        <input type="text" id="last_name" name="last_name" value="{{ current_user.last_name }}" required>
      </div>

      <div class="form-actions">
        <button type="submit" class="save-button">Save Changes</button>
      </div>
    </form>
  </main>

  <nav class="profile-nav">
    <h2>My Account</h2>
    <a href="{{ url_for('auth.profile') }}" class="active">Profile</a>
    <a href="{{ url_for('auth.change_password') }}">Change Password</a>
    <a href="{{ url_for('views.home') }}">Back to Home</a>
    <a href="{{ url_for('auth.logout') }}">Logout</a>
  </nav>
</div>

<script>
document.getElementById('profile-upload').addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (file) {
    // File size validation (max 5MB)
    if (file.size > 5 * 1024 * 1024) {
      alert('File size must be less than 5MB');
      this.value = '';
      return;
    }

    // File type validation
    if (!file.type.match('image.*')) {
      alert('Please select an image file');
      this.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('preview-image').src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
});
</script>
{% endblock %}
